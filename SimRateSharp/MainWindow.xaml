<!--
    * SimRateSharp is a simple overlay application for MSFS to display
    * simulation rate and reset sim-rate via joystick button as well as displaying other vital data.
    *
    * Copyright (C) 2025 Grant DeFayette / CavebatSoftware LLC 
    *
    * This program is free software: you can redistribute it and/or modify
    * it under the terms of the GNU General Public License as published by
    * the Free Software Foundation, version 3 of the License.
    *
    * This program is distributed in the hope that it will be useful,
    * but WITHOUT ANY WARRANTY; without even the implied warranty of
    * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    * GNU General Public License for more details.
    *
    * You should have received a copy of the GNU General Public License
    * along with this program.  If not, see <https://www.gnu.org/licenses/>.
-->
<Window x:Class="SimRateSharp.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:SimRateSharp"
        xmlns:res="clr-namespace:SimRateSharp.Resources"
        mc:Ignorable="d"
        Title="MSFS Sim Rate Monitor"
        SizeToContent="WidthAndHeight"
        WindowStartupLocation="Manual"
        ResizeMode="NoResize"
        Background="Transparent"
        AllowsTransparency="True"
        WindowStyle="None"
        Topmost="True"
        ShowInTaskbar="False">

    <Window.Resources>
        <!-- Modern Button Style -->
        <Style x:Key="ModernButton" TargetType="Button">
            <Setter Property="Background" Value="#60FFB300"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="12,6"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                CornerRadius="4"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center"
                                            VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#A0FFB300"/>
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="Background" Value="#FFFFB300"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <Border x:Name="MainBorder"
            Background="#C0000000"
            BorderBrush="#40FFFFFF"
            BorderThickness="1"
            CornerRadius="6"
            Padding="20,12"
            MouseLeftButtonDown="Border_MouseLeftButtonDown">
        <Border.Effect>
            <DropShadowEffect Color="Black"
                            Opacity="0.5"
                            BlurRadius="15"
                            ShadowDepth="0"/>
        </Border.Effect>

        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>  <!-- SimRate (with Reset Button) -->
                <ColumnDefinition Width="Auto"/>  <!-- GroundSpeed -->
                <ColumnDefinition Width="Auto"/>  <!-- AGL -->
                <ColumnDefinition Width="Auto"/>  <!-- GlideSlope -->
                <ColumnDefinition Width="Auto"/>  <!-- Wind -->
                <ColumnDefinition Width="Auto"/>  <!-- Torque -->
            </Grid.ColumnDefinitions>

            <!-- Capture Mode Overlay -->
            <Border x:Name="CaptureOverlay"
                    Grid.ColumnSpan="6"
                    Background="#E0000000"
                    CornerRadius="6"
                    Visibility="Collapsed"
                    Panel.ZIndex="100">
                <TextBlock x:Name="CaptureOverlayText"
                           Text="Press any joystick button..."
                           FontSize="18"
                           FontWeight="Bold"
                           Foreground="#FFB300"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"
                           TextAlignment="Center">
                    <TextBlock.Effect>
                        <DropShadowEffect Color="#FFB300"
                                        Opacity="0.8"
                                        BlurRadius="10"
                                        ShadowDepth="0"/>
                    </TextBlock.Effect>
                </TextBlock>
            </Border>

            <!-- Sim Rate Display with Reset Button -->
            <StackPanel x:Name="SimRatePanel" Grid.Column="0" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="10,0">
                <TextBlock x:Name="SimRatePanelHeader"
                           Text="⚡ SIM RATE"
                           FontSize="10"
                           Foreground="#80FFFFFF"
                           HorizontalAlignment="Center"
                           FontWeight="SemiBold"
                           Margin="0,0,0,2"/>
                <Grid HorizontalAlignment="Center">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock x:Name="SimRateTextBlock"
                               Grid.Column="0"
                               Text="--"
                               FontSize="24"
                               FontWeight="Bold"
                               Foreground="#00D9FF"
                               HorizontalAlignment="Center"
                               Margin="0,0,8,0">
                        <TextBlock.Effect>
                            <DropShadowEffect Color="#00D9FF"
                                            Opacity="0.6"
                                            BlurRadius="8"
                                            ShadowDepth="0"/>
                        </TextBlock.Effect>
                    </TextBlock>

                    <Button x:Name="ResetButton"
                            Grid.Column="1"
                            Content="1x"
                            Style="{StaticResource ModernButton}"
                            Click="ResetButton_Click"
                            VerticalAlignment="Center"
                            MinWidth="40"
                            Height="28"/>
                </Grid>
            </StackPanel>

            <!-- Ground Speed Display -->
            <StackPanel x:Name="GroundSpeedPanel" Grid.Column="1" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="10,0">
                <TextBlock x:Name="GroundSpeedPanelHeader"
                           Text="🛫 GROUND SPEED"
                           FontSize="10"
                           Foreground="#80FFFFFF"
                           HorizontalAlignment="Center"
                           FontWeight="SemiBold"
                           Margin="0,0,0,2"/>
                <TextBlock x:Name="GroundSpeedTextBlock"
                           Text="-- kts"
                           FontSize="24"
                           FontWeight="Bold"
                           Foreground="#00FF88"
                           HorizontalAlignment="Center">
                    <TextBlock.Effect>
                        <DropShadowEffect Color="#00FF88"
                                        Opacity="0.4"
                                        BlurRadius="8"
                                        ShadowDepth="0"/>
                    </TextBlock.Effect>
                </TextBlock>
            </StackPanel>

            <!-- AGL Display -->
            <StackPanel x:Name="AGLPanel" Grid.Column="2" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="10,0">
                <TextBlock x:Name="AGLPanelHeader"
                           Text="📏 AGL"
                           FontSize="10"
                           Foreground="#80FFFFFF"
                           HorizontalAlignment="Center"
                           FontWeight="SemiBold"
                           Margin="0,0,0,2"/>
                <TextBlock x:Name="AGLTextBlock"
                           Text="-- ft"
                           FontSize="24"
                           FontWeight="Bold"
                           Foreground="#FF9500"
                           HorizontalAlignment="Center">
                    <TextBlock.Effect>
                        <DropShadowEffect Color="#FF9500"
                                        Opacity="0.4"
                                        BlurRadius="8"
                                        ShadowDepth="0"/>
                    </TextBlock.Effect>
                </TextBlock>
            </StackPanel>

            <!-- Glide Slope Display -->
            <StackPanel x:Name="GlideSlopePanel" Grid.Column="3" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="10,0">
                <TextBlock x:Name="GlideSlopePanelHeader"
                           Text="📐 GLIDE"
                           FontSize="10"
                           Foreground="#80FFFFFF"
                           HorizontalAlignment="Center"
                           FontWeight="SemiBold"
                           Margin="0,0,0,2"/>
                <TextBlock x:Name="GlideSlopeTextBlock"
                           Text="--°"
                           FontSize="24"
                           FontWeight="Bold"
                           Foreground="#9C27B0"
                           HorizontalAlignment="Center">
                    <TextBlock.Effect>
                        <DropShadowEffect Color="#9C27B0"
                                        Opacity="0.4"
                                        BlurRadius="8"
                                        ShadowDepth="0"/>
                    </TextBlock.Effect>
                </TextBlock>
            </StackPanel>

            <!-- Wind Display -->
            <StackPanel x:Name="WindPanel" Grid.Column="4" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="10,0">
                <TextBlock x:Name="WindPanelHeader"
                           Text="💨 WIND"
                           FontSize="10"
                           Foreground="#80FFFFFF"
                           HorizontalAlignment="Center"
                           FontWeight="SemiBold"
                           Margin="0,0,0,2"/>
                <Grid HorizontalAlignment="Center">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="8"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="8"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- Wind Speed -->
                    <TextBlock x:Name="WindSpeedTextBlock"
                               Grid.Column="0"
                               Text="-- kts"
                               FontSize="12"
                               FontWeight="Bold"
                               Foreground="#FFB300"
                               VerticalAlignment="Center">
                        <TextBlock.Effect>
                            <DropShadowEffect Color="#FFB300"
                                            Opacity="0.4"
                                            BlurRadius="8"
                                            ShadowDepth="0"/>
                        </TextBlock.Effect>
                    </TextBlock>

                    <!-- Wind Arrow (relative to aircraft heading) -->
                    <Canvas x:Name="WindArrowCanvas"
                            Grid.Column="2"
                            Width="32"
                            Height="32"
                            VerticalAlignment="Center">
                        <Canvas.RenderTransform>
                            <RotateTransform x:Name="WindArrowRotation" Angle="0" CenterX="16" CenterY="16"/>
                        </Canvas.RenderTransform>
                        <!-- Circle background -->
                        <Ellipse Width="32" Height="32"
                                 Stroke="#60FFB300"
                                 StrokeThickness="2"
                                 Fill="#20FFB300"/>
                        <!-- Arrow pointing up (0° = wind from ahead) -->
                        <Path Data="M 16,8 L 20,16 L 18,16 L 18,24 L 14,24 L 14,16 L 12,16 Z"
                              Fill="#FFB300"
                              Stroke="#FFFFFF"
                              StrokeThickness="0.5">
                            <Path.Effect>
                                <DropShadowEffect Color="#FFB300"
                                                Opacity="0.6"
                                                BlurRadius="4"
                                                ShadowDepth="0"/>
                            </Path.Effect>
                        </Path>
                    </Canvas>

                    <!-- Relative Wind Angle -->
                    <TextBlock x:Name="WindAngleTextBlock"
                               Grid.Column="4"
                               Text="--°"
                               FontSize="12"
                               FontWeight="Bold"
                               Foreground="#FFB300"
                               VerticalAlignment="Center">
                        <TextBlock.Effect>
                            <DropShadowEffect Color="#FFB300"
                                            Opacity="0.4"
                                            BlurRadius="8"
                                            ShadowDepth="0"/>
                        </TextBlock.Effect>
                    </TextBlock>
                </Grid>
            </StackPanel>

            <!-- Torque Display (hidden by default) - Vertical Bar Gauges -->
            <StackPanel x:Name="TorquePanel" Grid.Column="5" HorizontalAlignment="Center" VerticalAlignment="Center" Visibility="Collapsed" Margin="10,0">
                <TextBlock x:Name="TorquePanelHeader"
                           Text="⚙️ TORQUE"
                           FontSize="10"
                           Foreground="#80FFFFFF"
                           HorizontalAlignment="Center"
                           FontWeight="SemiBold"
                           Margin="0,0,0,4"/>

                <!-- Container for engine bars (up to 4) -->
                <StackPanel x:Name="TorqueBarsContainer" Orientation="Horizontal" HorizontalAlignment="Center" Height="40">
                    <!-- Bars will be added dynamically in code-behind -->
                </StackPanel>
            </StackPanel>
        </Grid>
    </Border>
</Window>
